var A=Object.defineProperty;var C=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var U=(o,e,l)=>e in o?A(o,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[e]=l,f=(o,e)=>{for(var l in e||(e={}))R.call(e,l)&&U(o,l,e[l]);if(C)for(var l of C(e))T.call(e,l)&&U(o,l,e[l]);return o};import{E as j}from"./editUserInfo.js";import{l as b}from"./index.js";import{_ as Z}from"./plugin-vue_export-helper.js";import{r as a,o as c,n as h,b as t,w as r,m as d,t as q,c as v,l as y,F as M,e as H}from"./vendor.js";const J={components:{EditUserInfo:j},data(){return{tableData:[],searchForm:{name:"",gender:3,email:"",stuId:"",group:3},pagination:{pageSize:10,currentPage:1,total:1},editingUser:{},editingUserIndex:0,editDialogVisible:!1}},async mounted(){this.$http.get("/users",{headers:{token:b.getToken()}}).then(o=>{this.tableData=o.data.users,this.pagination.total=o.data["total-count"]})},methods:{editUser(o){this.editDialogVisible=!0,this.editingUserIndex=o,this.editingUser=f({},this.tableData[o]),this.editingUser.userStuId=+this.editingUser.userStuId},onSave(o,e="\u4FEE\u6539\u6210\u529F\uFF01"){this.$http.put(`/users/${o.userId}`,{userEmail:o.userEmail,userStuId:o.userStuId+"",userName:o.userName,userGender:o.userGender,userAge:o.userAge,userBio:o.userBio,userGroup:o.userGroup},{headers:{token:b.getToken()}}).then(l=>{l.status==200?(this.$message.success(e),this.editDialogVisible&&(this.editDialogVisible=!1),this.tableData[this.editingUserIndex]=f({},o)):this.$message.error(l.msg)})},modifyPwd(o){this.$prompt("\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801\uFF1A","\u4FEE\u6539\u5BC6\u7801",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/^(?=.*\d)(?=.*[a-zA-Z])[a-zA-Z0-9]{8,16}$/,inputErrorMessage:"\u5BC6\u7801\u4E0D\u7B26\u5408\u8981\u6C42"}).then(({value:e})=>{this.$http.put(`/users/${o}/password`,{userNewPwd:e},{headers:{token:b.getToken()}}).then(l=>{l.status==200?this.$message.success("\u4FEE\u6539\u5BC6\u7801\u6210\u529F\uFF01"):this.$message.error(l.msg)})}).catch(()=>{})},onCurrentPageChange(o){this.pagination.currentPage=o,this.onSearch()},onPageSizeChange(o){this.pagination.currentPage=1,this.pagination.pageSize=o,this.onSearch()},onRestoreUser(o){let e=this.tableData[o];this.editingUserIndex=o,this.onSave({userId:e.userId,userEmail:e.userEmail,userStuId:e.userStuId+"",userName:e.userName,userGender:e.userGender,userAge:e.userAge,userBio:e.userBio,userGroup:1},"\u6062\u590D\u6210\u529F\uFF01")},onRemoveUser(o){let e=this.tableData[o];this.editingUserIndex=o,this.onSave({userId:e.userId,userEmail:e.userEmail,userStuId:e.userStuId+"",userName:e.userName,userGender:e.userGender,userAge:e.userAge,userBio:e.userBio,userGroup:2},"\u7981\u7528\u6210\u529F\uFF01")},onSearch(o=!1){o&&(this.pagination.currentPage=1);let e={},l=this.searchForm;l.name!==""&&(e.name=l.name),l.gender!==3&&(e.gender=l.gender),l.email!==""&&(e.email=l.email),l.stuId!==""&&(e.stuId=l.stuId),l.group!==3&&(e.group=l.group),e.page=this.pagination.currentPage,e["page-size"]=this.pagination.pageSize,this.$http.get("/users",{headers:{token:b.getToken()},params:f({},e)}).then(I=>{this.tableData=I.data.users,this.pagination.total=I.data["total-count"]})},onSearchRecords(o){this.$router.push({path:"/records",query:{userId:o}})}}},K=d("\u641C\u7D22"),L=d("\u8BE6\u60C5"),O={key:0},Q={key:1},W={key:2},X=d("\u67E5\u8BE2\u501F\u9605\u8BB0\u5F55"),Y=d("\u6062\u590D"),$=d("\u4FEE\u6539\u5BC6\u7801"),ee=d("\u7F16\u8F91"),te=d("\u5220\u9664"),oe={class:"dialog-footer"},re=d("\u53D6\u6D88");function ne(o,e,l,I,s,i){const w=a("el-input"),g=a("el-form-item"),k=a("el-col"),S=a("el-row"),m=a("el-option"),V=a("el-select"),p=a("el-button"),D=a("el-form"),u=a("el-table-column"),G=a("el-link"),F=a("el-popover"),x=a("el-popconfirm"),E=a("el-table"),P=a("el-pagination"),B=a("el-card"),z=a("EditUserInfo"),N=a("el-dialog");return c(),h("div",null,[t(B,{shadow:"never"},{default:r(()=>[t(D,{inline:!0,model:s.searchForm},{default:r(()=>[t(S,null,{default:r(()=>[t(k,null,{default:r(()=>[t(g,{label:"\u90AE\u7BB1"},{default:r(()=>[t(w,{clearable:"",modelValue:s.searchForm.email,"onUpdate:modelValue":e[0]||(e[0]=n=>s.searchForm.email=n),placeholder:"\u90AE\u7BB1"},null,8,["modelValue"])]),_:1}),t(g,{label:"\u5B66\u53F7"},{default:r(()=>[t(w,{clearable:"",modelValue:s.searchForm.stuId,"onUpdate:modelValue":e[1]||(e[1]=n=>s.searchForm.stuId=n),placeholder:"\u5B66\u53F7"},null,8,["modelValue"])]),_:1}),t(g,{label:"\u59D3\u540D"},{default:r(()=>[t(w,{clearable:"",modelValue:s.searchForm.name,"onUpdate:modelValue":e[2]||(e[2]=n=>s.searchForm.name=n),placeholder:"\u59D3\u540D"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(S,null,{default:r(()=>[t(k,null,{default:r(()=>[t(g,{label:"\u6027\u522B"},{default:r(()=>[t(V,{placeholder:"\u6027\u522B",modelValue:s.searchForm.gender,"onUpdate:modelValue":e[3]||(e[3]=n=>s.searchForm.gender=n)},{default:r(()=>[t(m,{label:"\u5168\u90E8",value:3}),t(m,{label:"\u672A\u77E5",value:0}),t(m,{label:"\u7537",value:1}),t(m,{label:"\u5973",value:2})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"\u7528\u6237\u7EC4"},{default:r(()=>[t(V,{placeholder:"\u7528\u6237\u7EC4",modelValue:s.searchForm.group,"onUpdate:modelValue":e[4]||(e[4]=n=>s.searchForm.group=n)},{default:r(()=>[t(m,{label:"\u5168\u90E8",value:3}),t(m,{label:"\u7BA1\u7406\u5458",value:0}),t(m,{label:"\u666E\u901A\u7528\u6237",value:1}),t(m,{label:"\u7981\u7528\u7528\u6237",value:2})]),_:1},8,["modelValue"])]),_:1}),t(g,null,{default:r(()=>[t(p,{onClick:e[5]||(e[5]=n=>i.onSearch(!0)),icon:"search",type:"primary"},{default:r(()=>[K]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),t(E,{height:350,data:s.tableData,border:"",style:{margin:"20px 0"}},{default:r(()=>[t(u,{prop:"userId",label:"\u7528\u6237ID",width:"180"}),t(u,{prop:"userEmail",label:"\u90AE\u7BB1"}),t(u,{prop:"userStuId",label:"\u5B66\u53F7",width:"180"}),t(u,{prop:"userName",label:"\u59D3\u540D",width:"180"}),t(u,{label:"\u6027\u522B",width:"80"},{default:r(n=>[d(q(n.row.userGender===1?"\u7537":"\u5973"),1)]),_:1}),t(u,{prop:"userAge",label:"\u5E74\u9F84",width:"80"}),t(u,{label:"\u7B80\u4ECB",width:"80"},{default:r(n=>[n.row.userBio!=""?(c(),v(F,{key:0,placement:"bottom",width:200,trigger:"hover",content:n.row.userBio},{reference:r(()=>[t(G,{type:"primary"},{default:r(()=>[L]),_:1})]),_:2},1032,["content"])):y("",!0)]),_:1}),t(u,{prop:"userGroup",label:"\u7528\u6237\u7EC4",width:"100"},{default:r(n=>[n.row.userGroup===0?(c(),h("span",O,"\u7BA1\u7406\u5458")):n.row.userGroup===1?(c(),h("span",Q,"\u666E\u901A\u7528\u6237")):n.row.userGroup===2?(c(),h("span",W,"\u7981\u7528")):y("",!0)]),_:1}),t(u,{label:"\u64CD\u4F5C",width:"500"},{default:r(n=>[t(p,{onClick:_=>i.onSearchRecords(n.row.userId),type:"success",plain:"",icon:"search"},{default:r(()=>[X]),_:2},1032,["onClick"]),n.row.userGroup===2?(c(),v(p,{key:0,type:"primary",icon:"RefreshRight",onClick:_=>i.onRestoreUser(n.$index)},{default:r(()=>[Y]),_:2},1032,["onClick"])):(c(),h(M,{key:1},[t(p,{type:"warning",plain:"",onClick:_=>i.modifyPwd(n.row.userId),icon:"Edit"},{default:r(()=>[$]),_:2},1032,["onClick"]),t(p,{type:"warning",icon:"EditPen",onClick:_=>i.editUser(n.$index)},{default:r(()=>[ee]),_:2},1032,["onClick"]),t(x,{"confirm-button-text":"\u786E\u5B9A","cancel-button-text":"\u53D6\u6D88",icon:o.InfoFilled,"icon-color":"red",onConfirm:_=>i.onRemoveUser(n.$index),title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"},{reference:r(()=>[t(p,{type:"danger",icon:"delete"},{default:r(()=>[te]),_:1})]),_:2},1032,["icon","onConfirm"])],64))]),_:1})]),_:1},8,["data"]),t(P,{onCurrentChange:i.onCurrentPageChange,onSizeChange:i.onPageSizeChange,"page-sizes":[10,15,20],background:"","current-page":s.pagination.currentPage,layout:"sizes, prev, pager, next, jumper",total:s.pagination.total},null,8,["onCurrentChange","onSizeChange","current-page","total"])]),_:1}),t(N,{modelValue:s.editDialogVisible,"onUpdate:modelValue":e[7]||(e[7]=n=>s.editDialogVisible=n),title:"\u7F16\u8F91\u7528\u6237 "+s.editingUser.userId},{footer:r(()=>[H("span",oe,[t(p,{onClick:e[6]||(e[6]=n=>s.editDialogVisible=!1)},{default:r(()=>[re]),_:1})])]),default:r(()=>[t(z,{hasGroup:!0,style:{width:"60%"},onSubmit:i.onSave,data:s.editingUser},null,8,["onSubmit","data"])]),_:1},8,["modelValue","title"])])}var de=Z(J,[["render",ne]]);export{de as default};
