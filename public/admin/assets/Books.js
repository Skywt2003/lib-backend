var y=Object.defineProperty;var N=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var B=(t,o,a)=>o in t?y(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,p=(t,o)=>{for(var a in o||(o={}))z.call(o,a)&&B(t,a,o[a]);if(N)for(var a of N(o))T.call(o,a)&&B(t,a,o[a]);return t};import{_ as V}from"./plugin-vue_export-helper.js";import{r as n,o as S,c as v,w as l,b as e,m as c,n as E,e as A}from"./vendor.js";import{l as k}from"./index.js";const D={props:["data"],emits:["submit"],data(){return{rules:{bookName:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{type:"string",max:50,message:"\u4E0D\u80FD\u5927\u4E8E50\u4E2A\u5B57\u7B26",trigger:"blur"}],bookAuthor:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],bookISBN:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{type:"string",min:13,max:13,message:"\u5FC5\u987B\u662F13\u4F4D",trigger:"blur"}],bookPress:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{type:"string",max:20,message:"\u4E0D\u80FD\u5927\u4E8E20\u4E2A\u5B57\u7B26",trigger:"blur"}],bookTotalNumber:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}},methods:{btnClick(){this.$refs.rules.validate(t=>{if(t)this.$emit("submit",this.data);else return!1})}}},U=c("\u4FDD\u5B58\u4FEE\u6539");function q(t,o,a,h,s,d){const m=n("el-input"),r=n("el-form-item"),b=n("el-input-number"),_=n("el-button"),u=n("el-form");return S(),v(u,{style:{width:"50%"},rules:s.rules,ref:"rules","label-position":"right","label-width":"120px",model:a.data},{default:l(()=>[e(r,{label:"\u56FE\u4E66\u540D\u79F0",prop:"bookName"},{default:l(()=>[e(m,{modelValue:a.data.bookName,"onUpdate:modelValue":o[0]||(o[0]=i=>a.data.bookName=i)},null,8,["modelValue"])]),_:1}),e(r,{label:"\u4F5C\u8005",prop:"bookAuthor"},{default:l(()=>[e(m,{modelValue:a.data.bookAuthor,"onUpdate:modelValue":o[1]||(o[1]=i=>a.data.bookAuthor=i)},null,8,["modelValue"])]),_:1}),e(r,{label:"ISBN",prop:"bookISBN"},{default:l(()=>[e(m,{modelValue:a.data.bookISBN,"onUpdate:modelValue":o[2]||(o[2]=i=>a.data.bookISBN=i)},null,8,["modelValue"])]),_:1}),e(r,{label:"\u51FA\u7248\u793E",prop:"bookPress"},{default:l(()=>[e(m,{modelValue:a.data.bookPress,"onUpdate:modelValue":o[3]||(o[3]=i=>a.data.bookPress=i)},null,8,["modelValue"])]),_:1}),e(r,{label:"\u73B0\u5B58\u6570\u91CF"},{default:l(()=>[e(b,{size:"small",modelValue:a.data.bookExistingNumber,"onUpdate:modelValue":o[4]||(o[4]=i=>a.data.bookExistingNumber=i),"controls-position":"right",min:0,max:100,disabled:""},null,8,["modelValue"])]),_:1}),e(r,{label:"\u603B\u6570\u91CF",prop:"bookTotalNumber"},{default:l(()=>[e(b,{size:"small",modelValue:a.data.bookTotalNumber,"onUpdate:modelValue":o[5]||(o[5]=i=>a.data.bookTotalNumber=i),"controls-position":"right",min:0,max:100},null,8,["modelValue"])]),_:1}),e(r,{class:"t-right"},{default:l(()=>[e(_,{onClick:d.btnClick,type:"primary"},{default:l(()=>[U]),_:1},8,["onClick"])]),_:1})]),_:1},8,["rules","model"])}var R=V(D,[["render",q]]);const F={components:{EditBookInfo:R},data(){return{tableData:[],searchForm:{name:"",isbn:"",author:""},pagination:{pageSize:10,currentPage:1,total:1},editingBook:{},dialogVisible:!1,editingBookIndex:0}},async mounted(){this.$http.get("/books",{headers:{token:k.getToken()}}).then(t=>{this.tableData=t.data.books,this.pagination.total=t.data["total-count"]})},methods:{editBook(t){this.dialogVisible=!0,this.editingBookIndex=t,this.editingBook=p({},this.tableData[t])},onCurrentPageChange(t){this.pagination.currentPage=t,this.onSearch()},onPageSizeChange(t){this.pagination.currentPage=1,this.pagination.pageSize=t,this.onSearch()},onSearch(t=!1){t&&(this.pagination.currentPage=1);let o={},a=this.searchForm;a.name!==""&&(o.name=a.name),a.isbn!==""&&(o.isbn=a.isbn),a.author!==""&&(o.author=a.author),o.page=this.pagination.currentPage,o["page-size"]=this.pagination.pageSize,this.$http.get("/books",{headers:{token:k.getToken()},params:p({},o)}).then(h=>{this.tableData=h.data.books,this.pagination.total=h.data["total-count"]})},onSave(t){console.log(t),this.$http.put(`/books/${t.bookId}`,{bookName:t.bookName,bookAuthor:t.bookAuthor,bookISBN:t.bookISBN,bookPress:t.bookPress,bookExistingNumber:t.bookExistingNumber,bookTotalNumber:t.bookTotalNumber},{headers:{token:k.getToken()}}).then(o=>{o.status==200?(this.$message.success("\u4FEE\u6539\u6210\u529F\uFF01"),this.dialogVisible=!1,this.tableData[this.editingBookIndex]=p({},t)):this.$message.error(o.msg)})},onRemoveBook(t,o){this.$http.delete(`/books/${o}`,{headers:{token:k.getToken()}}).then(a=>{a.status===200?(this.$message.success("\u5220\u9664\u6210\u529F!"),this.onSearch()):this.$message.warning(a.msg)})},onSearchRecords(t){this.$router.push({path:"/records",query:{bookId:t}})}}},j=c("\u641C\u7D22"),$=c("\u67E5\u8BE2\u501F\u9605\u8BB0\u5F55"),G=c("\u7F16\u8F91"),H=c("\u5220\u9664"),J={class:"dialog-footer"},K=c("\u53D6\u6D88");function L(t,o,a,h,s,d){const m=n("el-input"),r=n("el-form-item"),b=n("el-button"),_=n("el-form"),u=n("el-table-column"),i=n("el-popconfirm"),x=n("el-table"),C=n("el-pagination"),I=n("el-card"),w=n("EditBookInfo"),P=n("el-dialog");return S(),E("div",null,[e(I,{shadow:"never"},{default:l(()=>[e(_,{inline:!0},{default:l(()=>[e(r,{label:"\u56FE\u4E66\u540D\u79F0"},{default:l(()=>[e(m,{clearable:"",placeholder:"\u56FE\u4E66\u540D\u79F0"})]),_:1}),e(r,{label:"ISBN"},{default:l(()=>[e(m,{clearable:"",placeholder:"ISBN"})]),_:1}),e(r,{label:"\u4F5C\u8005"},{default:l(()=>[e(m,{clearable:"",placeholder:"\u4F5C\u8005"})]),_:1}),e(r,null,{default:l(()=>[e(b,{icon:"search",type:"primary"},{default:l(()=>[j]),_:1})]),_:1})]),_:1}),e(x,{height:350,data:s.tableData,border:"",style:{margin:"20px 0",width:"100%"}},{default:l(()=>[e(u,{prop:"bookId",label:"\u56FE\u4E66ID",width:"150"}),e(u,{prop:"bookName",label:"\u56FE\u4E66\u540D\u79F0"}),e(u,{prop:"bookAuthor",label:"\u4F5C\u8005",width:"180"}),e(u,{prop:"bookISBN",label:"ISBN",width:"180"}),e(u,{prop:"bookPress",label:"\u51FA\u7248\u793E",width:"180"}),e(u,{prop:"bookExistingNumber",label:"\u73B0\u5B58\u6570\u91CF",width:"80"}),e(u,{prop:"bookTotalNumber",label:"\u603B\u6570\u91CF",width:"80"}),e(u,{label:"\u64CD\u4F5C",width:"400"},{default:l(g=>[e(b,{onClick:f=>d.onSearchRecords(g.row.bookId),type:"success",plain:"",icon:"search"},{default:l(()=>[$]),_:2},1032,["onClick"]),e(b,{type:"warning",icon:"edit",onClick:f=>d.editBook(g.$index)},{default:l(()=>[G]),_:2},1032,["onClick"]),e(i,{"confirm-button-text":"\u786E\u5B9A","cancel-button-text":"\u53D6\u6D88",icon:t.InfoFilled,onConfirm:f=>d.onRemoveBook(g.$index,g.row.bookId),"icon-color":"red",title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"},{reference:l(()=>[e(b,{type:"danger",icon:"delete"},{default:l(()=>[H]),_:1})]),_:2},1032,["icon","onConfirm"])]),_:1})]),_:1},8,["data"]),e(C,{onCurrentChange:d.onCurrentPageChange,onSizeChange:d.onPageSizeChange,"page-sizes":[10,15,20],background:"","current-page":s.pagination.currentPage,layout:"sizes, prev, pager, next, jumper",total:s.pagination.total},null,8,["onCurrentChange","onSizeChange","current-page","total"])]),_:1}),e(P,{modelValue:s.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=g=>s.dialogVisible=g),title:"\u7F16\u8F91\u56FE\u4E66 "+s.editingBook.bookId},{footer:l(()=>[A("span",J,[e(b,{onClick:o[0]||(o[0]=g=>s.dialogVisible=!1)},{default:l(()=>[K]),_:1})])]),default:l(()=>[e(w,{onSubmit:d.onSave,data:s.editingBook},null,8,["onSubmit","data"])]),_:1},8,["modelValue","title"])])}var X=V(F,[["render",L]]);export{X as default};
