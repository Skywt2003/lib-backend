var v=Object.defineProperty,D=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var S=(o,e,l)=>e in o?v(o,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[e]=l,c=(o,e)=>{for(var l in e||(e={}))E.call(e,l)&&S(o,l,e[l]);if(C)for(var l of C(e))z.call(e,l)&&S(o,l,e[l]);return o},x=(o,e)=>D(o,A(e));import{_ as I}from"./plugin-vue_export-helper.js";import{r as s,o as P,c as F,w as a,b as t,m as k,n as U,e as f}from"./vendor.js";import{l as p}from"./index.js";const q={props:["data"],emits:["submit"],data(){return{rules:{bookName:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{type:"string",max:50,message:"\u4E0D\u80FD\u5927\u4E8E50\u4E2A\u5B57\u7B26",trigger:"blur"}],bookAuthor:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],bookISBN:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{type:"string",min:13,max:13,message:"\u5FC5\u987B\u662F13\u4F4D",trigger:"blur"}],bookPress:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{type:"string",max:20,message:"\u4E0D\u80FD\u5927\u4E8E20\u4E2A\u5B57\u7B26",trigger:"blur"}],bookTotalNumber:[{required:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}},methods:{btnClick(){this.$refs.rules.validate(o=>{if(o)this.$emit("submit",this.data);else return!1})}}},R=k("\u4FDD\u5B58\u4FEE\u6539");function j(o,e,l,h,n,u){const g=s("el-input"),d=s("el-form-item"),m=s("el-input-number"),_=s("el-button"),b=s("el-form");return P(),F(b,{style:{width:"50%"},rules:n.rules,ref:"rules","label-position":"right","label-width":"120px",model:l.data},{default:a(()=>[t(d,{label:"\u56FE\u4E66\u540D\u79F0",prop:"bookName"},{default:a(()=>[t(g,{modelValue:l.data.bookName,"onUpdate:modelValue":e[0]||(e[0]=r=>l.data.bookName=r)},null,8,["modelValue"])]),_:1}),t(d,{label:"\u4F5C\u8005",prop:"bookAuthor"},{default:a(()=>[t(g,{modelValue:l.data.bookAuthor,"onUpdate:modelValue":e[1]||(e[1]=r=>l.data.bookAuthor=r)},null,8,["modelValue"])]),_:1}),t(d,{label:"ISBN",prop:"bookISBN"},{default:a(()=>[t(g,{modelValue:l.data.bookISBN,"onUpdate:modelValue":e[2]||(e[2]=r=>l.data.bookISBN=r)},null,8,["modelValue"])]),_:1}),t(d,{label:"\u51FA\u7248\u793E",prop:"bookPress"},{default:a(()=>[t(g,{modelValue:l.data.bookPress,"onUpdate:modelValue":e[3]||(e[3]=r=>l.data.bookPress=r)},null,8,["modelValue"])]),_:1}),t(d,{label:"\u73B0\u5B58\u6570\u91CF"},{default:a(()=>[t(m,{size:"small",modelValue:l.data.bookExistingNumber,"onUpdate:modelValue":e[4]||(e[4]=r=>l.data.bookExistingNumber=r),"controls-position":"right",min:0,max:100,disabled:""},null,8,["modelValue"])]),_:1}),t(d,{label:"\u603B\u6570\u91CF",prop:"bookTotalNumber"},{default:a(()=>[t(m,{size:"small",modelValue:l.data.bookTotalNumber,"onUpdate:modelValue":e[5]||(e[5]=r=>l.data.bookTotalNumber=r),"controls-position":"right",min:0,max:100},null,8,["modelValue"])]),_:1}),t(d,{class:"t-right"},{default:a(()=>[t(_,{onClick:u.btnClick,type:"primary"},{default:a(()=>[R]),_:1},8,["onClick"])]),_:1})]),_:1},8,["rules","model"])}var G=I(q,[["render",j]]);const H={components:{EditBookInfo:G},data(){return{tableData:[],searchForm:{name:"",isbn:"",author:""},pagination:{pageSize:10,currentPage:1,total:1},addDialogVisible:!1,editingBook:{},dialogVisible:!1,editingBookIndex:0}},async mounted(){this.$http.get("/books",{headers:{token:p.getToken()}}).then(o=>{this.tableData=o.data.books,this.pagination.total=o.data["total-count"]})},methods:{editBook(o){this.dialogVisible=!0,this.editingBookIndex=o,this.editingBook=c({},this.tableData[o])},addBook(){this.addDialogVisible=!0,this.editingBookIndex=0,this.editingBook={bookName:"",bookAuthor:"",bookISBN:"",bookPress:"",bookExistingNumber:0,bookTotalNumber:0}},onSaveAddBook(o){o.bookExistingNumber=o.bookTotalNumber,this.$http.post("/books",{bookName:o.bookName,bookAuthor:o.bookAuthor,bookISBN:o.bookISBN,bookPress:o.bookPress,bookExistingNumber:o.bookExistingNumber,bookTotalNumber:o.bookTotalNumber},{headers:{token:p.getToken()}}).then(e=>{e.status==200?(this.$message.success("\u65B0\u589E\u6210\u529F"),this.addDialogVisible&&(this.addDialogVisible=!1),this.tableData.unshift(x(c({},o),{bookId:e.data.bookId}))):this.$message.error(e.msg)})},onCurrentPageChange(o){this.pagination.currentPage=o,this.onSearch()},onPageSizeChange(o){this.pagination.currentPage=1,this.pagination.pageSize=o,this.onSearch()},onSearch(o=!1){o&&(this.pagination.currentPage=1);let e={},l=this.searchForm;l.name!==""&&(e.name=l.name),l.isbn!==""&&(e.isbn=l.isbn),l.author!==""&&(e.author=l.author),e.page=this.pagination.currentPage,e["page-size"]=this.pagination.pageSize,this.$http.get("/books",{headers:{token:p.getToken()},params:c({},e)}).then(h=>{this.tableData=h.data.books,this.pagination.total=h.data["total-count"]})},onSave(o){console.log(o),this.$http.put(`/books/${o.bookId}`,{bookName:o.bookName,bookAuthor:o.bookAuthor,bookISBN:o.bookISBN,bookPress:o.bookPress,bookExistingNumber:o.bookExistingNumber,bookTotalNumber:o.bookTotalNumber},{headers:{token:p.getToken()}}).then(e=>{e.status==200?(this.$message.success("\u4FEE\u6539\u6210\u529F\uFF01"),this.dialogVisible=!1,this.tableData[this.editingBookIndex]=c({},o)):this.$message.error(e.msg)})},onRemoveBook(o,e){this.$http.delete(`/books/${e}`,{headers:{token:p.getToken()}}).then(l=>{l.status===200?(this.$message.success("\u5220\u9664\u6210\u529F!"),this.onSearch()):this.$message.warning(l.msg)})},onSearchRecords(o){this.$router.push({path:"/records",query:{bookId:o}})},cellClick(o,e,l,h){console.log(o),e.no==1&&(this.searchForm.name=o.bookName),e.no==2&&(this.searchForm.author=o.bookAuthor)}}},J=k("\u641C\u7D22"),K=f("span",{style:{"margin-right":"10px"}},"\u64CD\u4F5C",-1),L=k("\u65B0\u589E\u56FE\u4E66"),M=k("\u67E5\u8BE2\u501F\u9605\u8BB0\u5F55"),O=k("\u7F16\u8F91"),Q=k("\u5220\u9664"),W={class:"dialog-footer"},X=k("\u53D6\u6D88"),Y={class:"dialog-footer"},Z=k("\u53D6\u6D88");function $(o,e,l,h,n,u){const g=s("el-input"),d=s("el-form-item"),m=s("el-button"),_=s("el-form"),b=s("el-table-column"),r=s("el-popconfirm"),w=s("el-table"),y=s("el-pagination"),T=s("el-card"),V=s("EditBookInfo"),N=s("el-dialog");return P(),U("div",null,[t(T,{shadow:"never"},{default:a(()=>[t(_,{inline:!0,model:"searchForm"},{default:a(()=>[t(d,{label:"\u56FE\u4E66\u540D\u79F0"},{default:a(()=>[t(g,{clearable:"",modelValue:n.searchForm.name,"onUpdate:modelValue":e[0]||(e[0]=i=>n.searchForm.name=i),placeholder:"\u56FE\u4E66\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(d,{label:"ISBN"},{default:a(()=>[t(g,{clearable:"",modelValue:n.searchForm.isbn,"onUpdate:modelValue":e[1]||(e[1]=i=>n.searchForm.isbn=i),placeholder:"ISBN"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u4F5C\u8005"},{default:a(()=>[t(g,{clearable:"",modelValue:n.searchForm.author,"onUpdate:modelValue":e[2]||(e[2]=i=>n.searchForm.author=i),placeholder:"\u4F5C\u8005"},null,8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(m,{onClick:u.onSearch,icon:"search",type:"primary"},{default:a(()=>[J]),_:1},8,["onClick"])]),_:1})]),_:1}),t(w,{onCellClick:u.cellClick,height:350,data:n.tableData,border:"",style:{margin:"20px 0",width:"100%"}},{default:a(()=>[t(b,{prop:"bookId",label:"\u56FE\u4E66ID",width:"100"}),t(b,{"show-overflow-tooltip":"",prop:"bookName",label:"\u56FE\u4E66\u540D\u79F0"}),t(b,{prop:"bookAuthor",label:"\u4F5C\u8005",width:"180"}),t(b,{prop:"bookISBN",label:"ISBN",width:"180"}),t(b,{"show-overflow-tooltip":"",prop:"bookPress",label:"\u51FA\u7248\u793E","max-width":"180"}),t(b,{prop:"bookExistingNumber",label:"\u73B0\u5B58\u6570\u91CF",width:"90"}),t(b,{prop:"bookTotalNumber",label:"\u603B\u6570\u91CF",width:"80"}),t(b,{label:"\u64CD\u4F5C",width:"400"},{header:a(()=>[K,t(m,{onClick:u.addBook,type:"success",icon:"plus"},{default:a(()=>[L]),_:1},8,["onClick"])]),default:a(i=>[t(m,{onClick:B=>u.onSearchRecords(i.row.bookId),type:"success",plain:"",icon:"search"},{default:a(()=>[M]),_:2},1032,["onClick"]),t(m,{type:"warning",icon:"edit",onClick:B=>u.editBook(i.$index)},{default:a(()=>[O]),_:2},1032,["onClick"]),t(r,{"confirm-button-text":"\u786E\u5B9A","cancel-button-text":"\u53D6\u6D88",icon:o.InfoFilled,onConfirm:B=>u.onRemoveBook(i.$index,i.row.bookId),"icon-color":"red",title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"},{reference:a(()=>[t(m,{type:"danger",icon:"delete"},{default:a(()=>[Q]),_:1})]),_:2},1032,["icon","onConfirm"])]),_:1})]),_:1},8,["onCellClick","data"]),t(y,{onCurrentChange:u.onCurrentPageChange,onSizeChange:u.onPageSizeChange,"page-sizes":[10,15,20],background:"","current-page":n.pagination.currentPage,layout:"sizes, prev, pager, next, jumper",total:n.pagination.total},null,8,["onCurrentChange","onSizeChange","current-page","total"])]),_:1}),t(N,{modelValue:n.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=i=>n.dialogVisible=i),title:"\u7F16\u8F91\u56FE\u4E66 "+n.editingBook.bookId},{footer:a(()=>[f("span",W,[t(m,{onClick:e[3]||(e[3]=i=>n.dialogVisible=!1)},{default:a(()=>[X]),_:1})])]),default:a(()=>[t(V,{onSubmit:u.onSave,data:n.editingBook},null,8,["onSubmit","data"])]),_:1},8,["modelValue","title"]),t(N,{modelValue:n.addDialogVisible,"onUpdate:modelValue":e[6]||(e[6]=i=>n.addDialogVisible=i),title:"\u65B0\u589E\u56FE\u4E66 "},{footer:a(()=>[f("span",Y,[t(m,{onClick:e[5]||(e[5]=i=>n.addDialogVisible=!1)},{default:a(()=>[Z]),_:1})])]),default:a(()=>[t(V,{onSubmit:u.onSaveAddBook,data:n.editingBook},null,8,["onSubmit","data"])]),_:1},8,["modelValue"])])}var ae=I(H,[["render",$]]);export{ae as default};
